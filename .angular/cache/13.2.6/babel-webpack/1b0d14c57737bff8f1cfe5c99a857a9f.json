{"ast":null,"code":"import { map } from 'rxjs';\nimport { BoardDataAccessService } from '@zombie/board/data-access';\nimport { Direction } from '@zombie/board/interfaces';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@zombie/board/data-access\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"../../../modals/onboarding/src/lib/home-modals-onboarding.component\";\nimport * as i4 from \"../../../modals/settings/src/lib/home-modals-settings.component\";\nimport * as i5 from \"../../../../board/ui/src/lib/board-ui.component\";\n\nfunction HomePageComponent_zombie_home_modals_onboarding_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"zombie-home-modals-onboarding\", 20);\n    i0.ɵɵlistener(\"dismiss\", function HomePageComponent_zombie_home_modals_onboarding_0_Template_zombie_home_modals_onboarding_dismiss_0_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return ctx_r4.onOnboardingModalDismiss();\n    });\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction HomePageComponent_zombie_home_modals_settings_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"zombie-home-modals-settings\", 21);\n    i0.ɵɵlistener(\"settings\", function HomePageComponent_zombie_home_modals_settings_1_Template_zombie_home_modals_settings_settings_0_listener($event) {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return ctx_r6.onSettingsUpdate($event);\n    })(\"dismiss\", function HomePageComponent_zombie_home_modals_settings_1_Template_zombie_home_modals_settings_dismiss_0_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return ctx_r8.onSettingsDismiss();\n    });\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"closeable\", ctx_r1.hasExistingBoard);\n  }\n}\n\nfunction HomePageComponent_h2_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h2\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.message, \" \");\n  }\n}\n\nfunction HomePageComponent_h2_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h2\", 22);\n    i0.ɵɵtext(1, \" The simulation has been completed \");\n    i0.ɵɵelementEnd();\n  }\n}\n\nexport class HomePageComponent {\n  constructor(board) {\n    this.board = board;\n    this.showOnboarding = true;\n    this.showSettings = false;\n    this.hasExistingBoard = false;\n    this.isRunning = true;\n    this.grid$ = this.board.fetchBoard().pipe(map(({\n      grid\n    }) => grid));\n    this.gridSize$ = this.board.fetchBoard().pipe(map(({\n      grid\n    }) => grid.length));\n    this.activeZombieId = 1;\n    this.moveCount = 0;\n    this.log = [];\n    this.resetSimulationMetadata();\n  }\n\n  get message() {\n    return this.log[this.log.length - 1] || '';\n  }\n\n  resetSimulationMetadata() {\n    var _a;\n\n    this.activeZombieId = ((_a = this.getZombiesAscId()[0]) === null || _a === void 0 ? void 0 : _a.id) || 0;\n    this.moveCount = 0;\n  }\n\n  getCreaturesAscId() {\n    return this.board.getCreatures().sort(({\n      id: a\n    }, {\n      id: b\n    }) => a - b);\n  }\n\n  getZombiesAscId() {\n    return this.board.getZombies().sort(({\n      id: a\n    }, {\n      id: b\n    }) => a - b);\n  }\n\n  incrementActiveZombieId() {\n    const zombiesInQueue = this.getZombiesAscId().filter(({\n      id\n    }) => id > this.activeZombieId);\n\n    if (!zombiesInQueue[0]) {\n      this.isRunning = false;\n      return false;\n    }\n\n    this.activeZombieId = zombiesInQueue[0].id;\n    return true;\n  }\n\n  nextButtonClick() {\n    this.moveSimulation();\n  }\n\n  moveSimulation() {\n    if (!this.isRunning) {\n      return;\n    }\n\n    const zombieId = this.activeZombieId;\n    const coords = this.getZombieCoords(zombieId); // infect oldest creature on same spot as active zombie\n\n    const creatures = this.board.getCreaturesOnCoordinate(coords);\n\n    if (creatures.length > 0) {\n      const oldestCreature = creatures.reduce((prev, curr) => prev.id < curr.id ? prev : curr, creatures[0]);\n      this.infectCreature(oldestCreature.id, coords);\n      this.log.push(`zombie ${zombieId} infected a creature at (${coords.x},${coords.y})`);\n      return;\n    } // move zombie\n\n\n    const {\n      moveSet\n    } = this.board.getBoard();\n    const nextMove = moveSet[this.moveCount] || null;\n\n    if (!nextMove) {\n      this.incrementActiveZombieId();\n      this.moveCount = 0;\n      return;\n    }\n\n    const newCoords = this.moveZombie(zombieId, nextMove);\n    this.log.push(`zombie ${zombieId} moved to (${newCoords.x},${newCoords.y})`);\n    this.moveCount++;\n  }\n\n  infectCreature(creatureId, coords) {\n    this.board.removeCreature(creatureId);\n    this.board.addZombieToCell(coords);\n  }\n\n  moveZombie(zombieId, direction) {\n    const coords = this.getZombieCoords(zombieId);\n    const board = this.board.getBoard();\n    const {\n      grid\n    } = board;\n    const destination = coords;\n\n    switch (direction) {\n      case Direction.UP:\n        destination.y = coords.y - 1 < 0 ? grid[coords.x].length - 1 : coords.y - 1;\n        break;\n\n      case Direction.DOWN:\n        destination.y = coords.y - 1 < 0 ? grid[coords.x].length - 1 : coords.y - 1;\n        break;\n\n      case Direction.LEFT:\n        destination.x = coords.x - 1 < 0 ? grid[coords.y].length - 1 : coords.x - 1;\n        break;\n\n      case Direction.RIGHT:\n        destination.x = coords.x + 1 > grid[coords.y].length - 1 ? 0 : coords.x + 1;\n        break;\n    }\n\n    this.board.removeZombie(zombieId);\n    this.board.addZombieToCell(coords, zombieId);\n    return destination;\n  }\n\n  getZombieCoords(zombieId) {\n    return this.board.getCoordsWithTokenAndId('ZOMBIE', zombieId)[0] || null;\n  }\n\n  onOnboardingModalDismiss() {\n    this.showOnboarding = false;\n    this.showSettings = true;\n  }\n\n  onSettingsUpdate(newBoard) {\n    this.showSettings = false;\n    this.hasExistingBoard = true; // update board state\n\n    this.board.setBoard(newBoard);\n    const zombies = this.getZombiesAscId();\n    const creatures = this.getCreaturesAscId();\n    this.board.newZombieId = zombies[zombies.length - 1].id + 1;\n    this.board.newCreatureId = creatures[creatures.length - 1].id + 1;\n    this.isRunning = true;\n    this.resetSimulationMetadata();\n  }\n\n  onSettingsDismiss() {\n    this.showSettings = false;\n  }\n\n  onTileClick(coords) {\n    this.showTileDetails(coords);\n  }\n\n  showTileDetails(coords) {\n    const tile = this.board.getTokensOnCoordinate(coords);\n  }\n\n  openSettings() {\n    this.showSettings = true;\n  }\n\n}\n\nHomePageComponent.ɵfac = function HomePageComponent_Factory(t) {\n  return new (t || HomePageComponent)(i0.ɵɵdirectiveInject(i1.BoardDataAccessService));\n};\n\nHomePageComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: HomePageComponent,\n  selectors: [[\"zombie-home-page\"]],\n  decls: 28,\n  vars: 8,\n  consts: [[\"data-testid\", \"onboarding-modal\", 3, \"dismiss\", 4, \"ngIf\"], [3, \"closeable\", \"settings\", \"dismiss\", 4, \"ngIf\"], [1, \"max-w-2xl\", \"min-h-full\", \"p-8\", \"py-4\", \"mx-auto\"], [1, \"lg:flex\", \"lg:items-center\", \"lg:justify-between\"], [1, \"flex-1\", \"min-w-0\"], [1, \"text-2xl\", \"font-bold\", \"leading-7\", \"text-gray-900\", \"sm:text-3xl\", \"sm:truncate\"], [1, \"flex\", \"mt-5\", \"lg:mt-0\", \"lg:ml-4\"], [1, \"hidden\", \"sm:block\"], [\"type\", \"button\", 1, \"inline-flex\", \"items-center\", \"px-4\", \"py-2\", \"text-sm\", \"font-medium\", \"text-gray-700\", \"bg-white\", \"border\", \"border-gray-300\", \"rounded-md\", \"shadow-sm\", \"hover:bg-gray-50\", \"focus:outline-none\", \"focus:ring-2\", \"focus:ring-offset-2\", \"focus:ring-indigo-500\", 3, \"click\"], [\"xmlns\", \"http://www.w3.org/2000/svg\", \"fill\", \"none\", \"viewBox\", \"0 0 24 24\", \"stroke\", \"currentColor\", \"stroke-width\", \"2\", 1, \"w-6\", \"h-6\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"d\", \"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"d\", \"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"], [1, \"pl-2\"], [1, \"hidden\", \"ml-3\", \"sm:block\"], [\"type\", \"button\", 1, \"inline-flex\", \"items-center\", \"px-4\", \"py-2\", \"text-sm\", \"font-medium\", \"text-gray-700\", \"bg-white\", \"border\", \"border-gray-300\", \"rounded-md\", \"shadow-sm\", \"hover:bg-gray-50\", \"focus:outline-none\", \"focus:ring-2\", \"focus:ring-offset-2\", \"focus:ring-indigo-500\", 3, \"disabled\", \"click\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"d\", \"M13 9l3 3m0 0l-3 3m3-3H8m13 0a9 9 0 11-18 0 9 9 0 0118 0z\"], [1, \"mt-2\"], [\"class\", \"text-xl font-bold leading-7 text-gray-400 sm:text-3xl sm:truncate\", 4, \"ngIf\"], [1, \"px-1\", \"pt-5\", \"mx-auto\", \"max-w-7xl\"], [3, \"grid\", \"tileClicked\"], [\"data-testid\", \"onboarding-modal\", 3, \"dismiss\"], [3, \"closeable\", \"settings\", \"dismiss\"], [1, \"text-xl\", \"font-bold\", \"leading-7\", \"text-gray-400\", \"sm:text-3xl\", \"sm:truncate\"]],\n  template: function HomePageComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, HomePageComponent_zombie_home_modals_onboarding_0_Template, 1, 0, \"zombie-home-modals-onboarding\", 0);\n      i0.ɵɵtemplate(1, HomePageComponent_zombie_home_modals_settings_1_Template, 1, 1, \"zombie-home-modals-settings\", 1);\n      i0.ɵɵelementStart(2, \"div\", 2)(3, \"div\", 3)(4, \"div\", 4)(5, \"h1\", 5);\n      i0.ɵɵtext(6, \" Zombie \");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(7, \"div\", 6)(8, \"span\", 7)(9, \"button\", 8);\n      i0.ɵɵlistener(\"click\", function HomePageComponent_Template_button_click_9_listener() {\n        return ctx.openSettings();\n      });\n      i0.ɵɵnamespaceSVG();\n      i0.ɵɵelementStart(10, \"svg\", 9);\n      i0.ɵɵelement(11, \"path\", 10)(12, \"path\", 11);\n      i0.ɵɵelementEnd();\n      i0.ɵɵnamespaceHTML();\n      i0.ɵɵelementStart(13, \"span\", 12);\n      i0.ɵɵtext(14, \"Settings\");\n      i0.ɵɵelementEnd()()();\n      i0.ɵɵelementStart(15, \"span\", 13)(16, \"button\", 14);\n      i0.ɵɵlistener(\"click\", function HomePageComponent_Template_button_click_16_listener() {\n        return ctx.nextButtonClick();\n      });\n      i0.ɵɵnamespaceSVG();\n      i0.ɵɵelementStart(17, \"svg\", 9);\n      i0.ɵɵelement(18, \"path\", 15);\n      i0.ɵɵelementEnd();\n      i0.ɵɵnamespaceHTML();\n      i0.ɵɵelementStart(19, \"span\", 12);\n      i0.ɵɵtext(20, \"Next\");\n      i0.ɵɵelementEnd()()()()();\n      i0.ɵɵelementStart(21, \"div\", 16);\n      i0.ɵɵtemplate(22, HomePageComponent_h2_22_Template, 2, 1, \"h2\", 17);\n      i0.ɵɵtemplate(23, HomePageComponent_h2_23_Template, 2, 0, \"h2\", 17);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(24, \"main\")(25, \"div\", 18)(26, \"zombie-board-ui\", 19);\n      i0.ɵɵlistener(\"tileClicked\", function HomePageComponent_Template_zombie_board_ui_tileClicked_26_listener($event) {\n        return ctx.onTileClick($event);\n      });\n      i0.ɵɵpipe(27, \"async\");\n      i0.ɵɵelementEnd()()()();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.showOnboarding);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", ctx.showSettings);\n      i0.ɵɵadvance(15);\n      i0.ɵɵproperty(\"disabled\", !ctx.isRunning);\n      i0.ɵɵadvance(6);\n      i0.ɵɵproperty(\"ngIf\", ctx.message);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.isRunning);\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"grid\", i0.ɵɵpipeBind1(27, 6, ctx.grid$));\n    }\n  },\n  directives: [i2.NgIf, i3.HomeModalsOnboardingComponent, i4.HomeModalsSettingsComponent, i5.BoardUiComponent],\n  pipes: [i2.AsyncPipe],\n  encapsulation: 2\n});","map":{"version":3,"sources":["/Users/udaysingh/Documents/zombie/libs/home/page/src/lib/home-page.component.ts"],"names":["map","BoardDataAccessService","Direction","i0","i1","i2","i3","i4","i5","HomePageComponent_zombie_home_modals_onboarding_0_Template","rf","ctx","_r5","ɵɵgetCurrentView","ɵɵelementStart","ɵɵlistener","HomePageComponent_zombie_home_modals_onboarding_0_Template_zombie_home_modals_onboarding_dismiss_0_listener","ɵɵrestoreView","ctx_r4","ɵɵnextContext","onOnboardingModalDismiss","ɵɵelementEnd","HomePageComponent_zombie_home_modals_settings_1_Template","_r7","HomePageComponent_zombie_home_modals_settings_1_Template_zombie_home_modals_settings_settings_0_listener","$event","ctx_r6","onSettingsUpdate","HomePageComponent_zombie_home_modals_settings_1_Template_zombie_home_modals_settings_dismiss_0_listener","ctx_r8","onSettingsDismiss","ctx_r1","ɵɵproperty","hasExistingBoard","HomePageComponent_h2_22_Template","ɵɵtext","ctx_r2","ɵɵadvance","ɵɵtextInterpolate1","message","HomePageComponent_h2_23_Template","HomePageComponent","constructor","board","showOnboarding","showSettings","isRunning","grid$","fetchBoard","pipe","grid","gridSize$","length","activeZombieId","moveCount","log","resetSimulationMetadata","_a","getZombiesAscId","id","getCreaturesAscId","getCreatures","sort","a","b","getZombies","incrementActiveZombieId","zombiesInQueue","filter","nextButtonClick","moveSimulation","zombieId","coords","getZombieCoords","creatures","getCreaturesOnCoordinate","oldestCreature","reduce","prev","curr","infectCreature","push","x","y","moveSet","getBoard","nextMove","newCoords","moveZombie","creatureId","removeCreature","addZombieToCell","direction","destination","UP","DOWN","LEFT","RIGHT","removeZombie","getCoordsWithTokenAndId","newBoard","setBoard","zombies","newZombieId","newCreatureId","onTileClick","showTileDetails","tile","getTokensOnCoordinate","openSettings","ɵfac","HomePageComponent_Factory","t","ɵɵdirectiveInject","ɵcmp","ɵɵdefineComponent","type","selectors","decls","vars","consts","template","HomePageComponent_Template","ɵɵtemplate","HomePageComponent_Template_button_click_9_listener","ɵɵnamespaceSVG","ɵɵelement","ɵɵnamespaceHTML","HomePageComponent_Template_button_click_16_listener","HomePageComponent_Template_zombie_board_ui_tileClicked_26_listener","ɵɵpipe","ɵɵpipeBind1","directives","NgIf","HomeModalsOnboardingComponent","HomeModalsSettingsComponent","BoardUiComponent","pipes","AsyncPipe","encapsulation"],"mappings":"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","sourcesContent":["import { map } from 'rxjs';\nimport { BoardDataAccessService } from '@zombie/board/data-access';\nimport { Direction, } from '@zombie/board/interfaces';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@zombie/board/data-access\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"../../../modals/onboarding/src/lib/home-modals-onboarding.component\";\nimport * as i4 from \"../../../modals/settings/src/lib/home-modals-settings.component\";\nimport * as i5 from \"../../../../board/ui/src/lib/board-ui.component\";\nfunction HomePageComponent_zombie_home_modals_onboarding_0_Template(rf, ctx) { if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"zombie-home-modals-onboarding\", 20);\n    i0.ɵɵlistener(\"dismiss\", function HomePageComponent_zombie_home_modals_onboarding_0_Template_zombie_home_modals_onboarding_dismiss_0_listener() { i0.ɵɵrestoreView(_r5); const ctx_r4 = i0.ɵɵnextContext(); return ctx_r4.onOnboardingModalDismiss(); });\n    i0.ɵɵelementEnd();\n} }\nfunction HomePageComponent_zombie_home_modals_settings_1_Template(rf, ctx) { if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"zombie-home-modals-settings\", 21);\n    i0.ɵɵlistener(\"settings\", function HomePageComponent_zombie_home_modals_settings_1_Template_zombie_home_modals_settings_settings_0_listener($event) { i0.ɵɵrestoreView(_r7); const ctx_r6 = i0.ɵɵnextContext(); return ctx_r6.onSettingsUpdate($event); })(\"dismiss\", function HomePageComponent_zombie_home_modals_settings_1_Template_zombie_home_modals_settings_dismiss_0_listener() { i0.ɵɵrestoreView(_r7); const ctx_r8 = i0.ɵɵnextContext(); return ctx_r8.onSettingsDismiss(); });\n    i0.ɵɵelementEnd();\n} if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵproperty(\"closeable\", ctx_r1.hasExistingBoard);\n} }\nfunction HomePageComponent_h2_22_Template(rf, ctx) { if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h2\", 22);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n} if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r2.message, \" \");\n} }\nfunction HomePageComponent_h2_23_Template(rf, ctx) { if (rf & 1) {\n    i0.ɵɵelementStart(0, \"h2\", 22);\n    i0.ɵɵtext(1, \" The simulation has been completed \");\n    i0.ɵɵelementEnd();\n} }\nexport class HomePageComponent {\n    constructor(board) {\n        this.board = board;\n        this.showOnboarding = true;\n        this.showSettings = false;\n        this.hasExistingBoard = false;\n        this.isRunning = true;\n        this.grid$ = this.board.fetchBoard().pipe(map(({ grid }) => grid));\n        this.gridSize$ = this.board.fetchBoard().pipe(map(({ grid }) => grid.length));\n        this.activeZombieId = 1;\n        this.moveCount = 0;\n        this.log = [];\n        this.resetSimulationMetadata();\n    }\n    get message() {\n        return this.log[this.log.length - 1] || '';\n    }\n    resetSimulationMetadata() {\n        var _a;\n        this.activeZombieId = ((_a = this.getZombiesAscId()[0]) === null || _a === void 0 ? void 0 : _a.id) || 0;\n        this.moveCount = 0;\n    }\n    getCreaturesAscId() {\n        return this.board.getCreatures().sort(({ id: a }, { id: b }) => a - b);\n    }\n    getZombiesAscId() {\n        return this.board.getZombies().sort(({ id: a }, { id: b }) => a - b);\n    }\n    incrementActiveZombieId() {\n        const zombiesInQueue = this.getZombiesAscId().filter(({ id }) => id > this.activeZombieId);\n        if (!zombiesInQueue[0]) {\n            this.isRunning = false;\n            return false;\n        }\n        this.activeZombieId = zombiesInQueue[0].id;\n        return true;\n    }\n    nextButtonClick() {\n        this.moveSimulation();\n    }\n    moveSimulation() {\n        if (!this.isRunning) {\n            return;\n        }\n        const zombieId = this.activeZombieId;\n        const coords = this.getZombieCoords(zombieId);\n        // infect oldest creature on same spot as active zombie\n        const creatures = this.board.getCreaturesOnCoordinate(coords);\n        if (creatures.length > 0) {\n            const oldestCreature = creatures.reduce((prev, curr) => (prev.id < curr.id ? prev : curr), creatures[0]);\n            this.infectCreature(oldestCreature.id, coords);\n            this.log.push(`zombie ${zombieId} infected a creature at (${coords.x},${coords.y})`);\n            return;\n        }\n        // move zombie\n        const { moveSet } = this.board.getBoard();\n        const nextMove = moveSet[this.moveCount] || null;\n        if (!nextMove) {\n            this.incrementActiveZombieId();\n            this.moveCount = 0;\n            return;\n        }\n        const newCoords = this.moveZombie(zombieId, nextMove);\n        this.log.push(`zombie ${zombieId} moved to (${newCoords.x},${newCoords.y})`);\n        this.moveCount++;\n    }\n    infectCreature(creatureId, coords) {\n        this.board.removeCreature(creatureId);\n        this.board.addZombieToCell(coords);\n    }\n    moveZombie(zombieId, direction) {\n        const coords = this.getZombieCoords(zombieId);\n        const board = this.board.getBoard();\n        const { grid } = board;\n        const destination = coords;\n        switch (direction) {\n            case Direction.UP:\n                destination.y =\n                    coords.y - 1 < 0 ? grid[coords.x].length - 1 : coords.y - 1;\n                break;\n            case Direction.DOWN:\n                destination.y =\n                    coords.y - 1 < 0 ? grid[coords.x].length - 1 : coords.y - 1;\n                break;\n            case Direction.LEFT:\n                destination.x =\n                    coords.x - 1 < 0 ? grid[coords.y].length - 1 : coords.x - 1;\n                break;\n            case Direction.RIGHT:\n                destination.x =\n                    coords.x + 1 > grid[coords.y].length - 1 ? 0 : coords.x + 1;\n                break;\n        }\n        this.board.removeZombie(zombieId);\n        this.board.addZombieToCell(coords, zombieId);\n        return destination;\n    }\n    getZombieCoords(zombieId) {\n        return this.board.getCoordsWithTokenAndId('ZOMBIE', zombieId)[0] || null;\n    }\n    onOnboardingModalDismiss() {\n        this.showOnboarding = false;\n        this.showSettings = true;\n    }\n    onSettingsUpdate(newBoard) {\n        this.showSettings = false;\n        this.hasExistingBoard = true;\n        // update board state\n        this.board.setBoard(newBoard);\n        const zombies = this.getZombiesAscId();\n        const creatures = this.getCreaturesAscId();\n        this.board.newZombieId = zombies[zombies.length - 1].id + 1;\n        this.board.newCreatureId = creatures[creatures.length - 1].id + 1;\n        this.isRunning = true;\n        this.resetSimulationMetadata();\n    }\n    onSettingsDismiss() {\n        this.showSettings = false;\n    }\n    onTileClick(coords) {\n        this.showTileDetails(coords);\n    }\n    showTileDetails(coords) {\n        const tile = this.board.getTokensOnCoordinate(coords);\n    }\n    openSettings() {\n        this.showSettings = true;\n    }\n}\nHomePageComponent.ɵfac = function HomePageComponent_Factory(t) { return new (t || HomePageComponent)(i0.ɵɵdirectiveInject(i1.BoardDataAccessService)); };\nHomePageComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: HomePageComponent, selectors: [[\"zombie-home-page\"]], decls: 28, vars: 8, consts: [[\"data-testid\", \"onboarding-modal\", 3, \"dismiss\", 4, \"ngIf\"], [3, \"closeable\", \"settings\", \"dismiss\", 4, \"ngIf\"], [1, \"max-w-2xl\", \"min-h-full\", \"p-8\", \"py-4\", \"mx-auto\"], [1, \"lg:flex\", \"lg:items-center\", \"lg:justify-between\"], [1, \"flex-1\", \"min-w-0\"], [1, \"text-2xl\", \"font-bold\", \"leading-7\", \"text-gray-900\", \"sm:text-3xl\", \"sm:truncate\"], [1, \"flex\", \"mt-5\", \"lg:mt-0\", \"lg:ml-4\"], [1, \"hidden\", \"sm:block\"], [\"type\", \"button\", 1, \"inline-flex\", \"items-center\", \"px-4\", \"py-2\", \"text-sm\", \"font-medium\", \"text-gray-700\", \"bg-white\", \"border\", \"border-gray-300\", \"rounded-md\", \"shadow-sm\", \"hover:bg-gray-50\", \"focus:outline-none\", \"focus:ring-2\", \"focus:ring-offset-2\", \"focus:ring-indigo-500\", 3, \"click\"], [\"xmlns\", \"http://www.w3.org/2000/svg\", \"fill\", \"none\", \"viewBox\", \"0 0 24 24\", \"stroke\", \"currentColor\", \"stroke-width\", \"2\", 1, \"w-6\", \"h-6\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"d\", \"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"d\", \"M15 12a3 3 0 11-6 0 3 3 0 016 0z\"], [1, \"pl-2\"], [1, \"hidden\", \"ml-3\", \"sm:block\"], [\"type\", \"button\", 1, \"inline-flex\", \"items-center\", \"px-4\", \"py-2\", \"text-sm\", \"font-medium\", \"text-gray-700\", \"bg-white\", \"border\", \"border-gray-300\", \"rounded-md\", \"shadow-sm\", \"hover:bg-gray-50\", \"focus:outline-none\", \"focus:ring-2\", \"focus:ring-offset-2\", \"focus:ring-indigo-500\", 3, \"disabled\", \"click\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"d\", \"M13 9l3 3m0 0l-3 3m3-3H8m13 0a9 9 0 11-18 0 9 9 0 0118 0z\"], [1, \"mt-2\"], [\"class\", \"text-xl font-bold leading-7 text-gray-400 sm:text-3xl sm:truncate\", 4, \"ngIf\"], [1, \"px-1\", \"pt-5\", \"mx-auto\", \"max-w-7xl\"], [3, \"grid\", \"tileClicked\"], [\"data-testid\", \"onboarding-modal\", 3, \"dismiss\"], [3, \"closeable\", \"settings\", \"dismiss\"], [1, \"text-xl\", \"font-bold\", \"leading-7\", \"text-gray-400\", \"sm:text-3xl\", \"sm:truncate\"]], template: function HomePageComponent_Template(rf, ctx) { if (rf & 1) {\n        i0.ɵɵtemplate(0, HomePageComponent_zombie_home_modals_onboarding_0_Template, 1, 0, \"zombie-home-modals-onboarding\", 0);\n        i0.ɵɵtemplate(1, HomePageComponent_zombie_home_modals_settings_1_Template, 1, 1, \"zombie-home-modals-settings\", 1);\n        i0.ɵɵelementStart(2, \"div\", 2)(3, \"div\", 3)(4, \"div\", 4)(5, \"h1\", 5);\n        i0.ɵɵtext(6, \" Zombie \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(7, \"div\", 6)(8, \"span\", 7)(9, \"button\", 8);\n        i0.ɵɵlistener(\"click\", function HomePageComponent_Template_button_click_9_listener() { return ctx.openSettings(); });\n        i0.ɵɵnamespaceSVG();\n        i0.ɵɵelementStart(10, \"svg\", 9);\n        i0.ɵɵelement(11, \"path\", 10)(12, \"path\", 11);\n        i0.ɵɵelementEnd();\n        i0.ɵɵnamespaceHTML();\n        i0.ɵɵelementStart(13, \"span\", 12);\n        i0.ɵɵtext(14, \"Settings\");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(15, \"span\", 13)(16, \"button\", 14);\n        i0.ɵɵlistener(\"click\", function HomePageComponent_Template_button_click_16_listener() { return ctx.nextButtonClick(); });\n        i0.ɵɵnamespaceSVG();\n        i0.ɵɵelementStart(17, \"svg\", 9);\n        i0.ɵɵelement(18, \"path\", 15);\n        i0.ɵɵelementEnd();\n        i0.ɵɵnamespaceHTML();\n        i0.ɵɵelementStart(19, \"span\", 12);\n        i0.ɵɵtext(20, \"Next\");\n        i0.ɵɵelementEnd()()()()();\n        i0.ɵɵelementStart(21, \"div\", 16);\n        i0.ɵɵtemplate(22, HomePageComponent_h2_22_Template, 2, 1, \"h2\", 17);\n        i0.ɵɵtemplate(23, HomePageComponent_h2_23_Template, 2, 0, \"h2\", 17);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"main\")(25, \"div\", 18)(26, \"zombie-board-ui\", 19);\n        i0.ɵɵlistener(\"tileClicked\", function HomePageComponent_Template_zombie_board_ui_tileClicked_26_listener($event) { return ctx.onTileClick($event); });\n        i0.ɵɵpipe(27, \"async\");\n        i0.ɵɵelementEnd()()()();\n    } if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.showOnboarding);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.showSettings);\n        i0.ɵɵadvance(15);\n        i0.ɵɵproperty(\"disabled\", !ctx.isRunning);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngIf\", ctx.message);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.isRunning);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"grid\", i0.ɵɵpipeBind1(27, 6, ctx.grid$));\n    } }, directives: [i2.NgIf, i3.HomeModalsOnboardingComponent, i4.HomeModalsSettingsComponent, i5.BoardUiComponent], pipes: [i2.AsyncPipe], encapsulation: 2 });\n"]},"metadata":{},"sourceType":"module"}